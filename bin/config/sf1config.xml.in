<?xml version="1.0" encoding="UTF-8"?>


<!-- configuration for SF-11 Revolution -->
<SF1Config xmlns="http://www.izenesoft.com" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://www.izenesoft.com sf1config.xsd">
  <!-- ======== SYSTEM CONFIGURATIONS ======== -->
  <!--
       DESCRIPTION: Sets up system settings.
  -->
  <System>
    <Resource path="@SF1RENGINE_ROOT@/package/resource"/>
    <WorkingDir path="@SF1RENGINE_ROOT@/bin"/>

    <!-- examples of configuration on "LogConnection":
         for sqlite3 db: "sqlite3://./log/COBRA"
         for mysql db: "mysql://root:123456@127.0.0.1:3306/SF1R"
    -->
    <LogConnection str="sqlite3://./log/COBRA"/>

    <!-- Format of value of str:

             "cassandra://[username:password@]host:port[/keyspace]"

         Examples:

             "cassandra://localhost"
             "cassandra://172.16.0.163"
             "cassandra://172.16.0.163/SF1R_TEST"

         Notes:
             - Fields in square brackets are optional
             - IPv6 ip address has not been properly parsed now (lacking demand)
             - To fully disable use of Cassandra, be free to set it to "__disabled__"
               or any value that can not satisfy the parser :)
    -->
    <!-- <CassandraConnection str="cassandra://211.152.36.219/B5MM"/> -->
    <CassandraConnection str="__disabled__"/>

    <BundlesDefault>
      <!-- Index Bundle Default -->
      <IndexBundle>
        <Parameter>
          <!-- Specify multiple index directory to support backup and directory rotating -->
          <CollectionDataDirectory>default-collection-dir</CollectionDataDirectory>
          <!-- <CollectionDataDirectory>collection-dir-A</CollectionDataDirectory> -->
          <!-- <CollectionDataDirectory>collection-dir-B</CollectionDataDirectory> -->
          <IndexStrategy memorypoolsize="128000000" indexlevel="wordlevel" indexpolicy="default" mergepolicy="file" cron="0 3 * * *"/>
          <!-- indexlevel could be set for both "doclevel" or "wordlevel", when doclevel is set, PLM ranking model will be changed to BM25 and only
               dfp posting is used for ranking during search process.
          -->
          <!-- mergepolicy could be set for both "memory" or "file", which is used to indicate the situation that when it requires an extra intermediate
               storage space to guarantee the skiplist to be at the head of each posting during index merging, this parameter is used to indicate the type
               of that extra storage space. "file" refers to file, "memory" refers to memory. If "memory" is set, the extra memory consumption equals to
               the maximum posting length, while if "file" is set, it might cause low efficiency on some specified kind of disks.
          -->

          <!-- In unigram searching mode (unigramsearchmode="y"), searching performs on unigram terms, while ranking performs on word segments.
               Make sure unigram terms have been indexed for Property (LA for Indexing is "la_sia_with_unigram"), or search(retrieve) may fail.
          -->
          <Sia triggerqa="n" doccachenum="20000" searchcachenum="1000" filtercachenum="1000" mastersearchcachenum="1000" topknum="4000"
               encoding="UTF-8" wildcardtype="unigram" indexunigramproperty="n" unigramsearchmode="n" multilanggranularity="field"/>


          <LanguageIdentifier dbpath="@ilplib_LANGUAGEIDENTIFIER_DB@"/>

        </Parameter>
      </IndexBundle>

      <ProductBundle>
        <Parameter>
          <CollectionDataDirectory>default-collection-dir</CollectionDataDirectory>
          <CronPara value="0 1 * * *"/>
        </Parameter>
      </ProductBundle>

      <MiningBundle>
        <Parameter>
          <!-- Specify multiple index directory to support backup and directory rotating -->
          <CollectionDataDirectory>default-collection-dir</CollectionDataDirectory>
          <TaxonomyPara topdocnum="100" levels="3" perlevelnum="8" candlabelnum="250" enablenec="n" maxpeopnum="20" maxlocnum="20" maxorgnum="20"/>
          <RecommendPara recommendnum="9" cron="0 2 * * *" />
          <SimilarityPara docnumlimit="100" termnumlimit="400000" enableesa="n"/>
          <ClassificationPara customizetraining="n" trainingencoding="UTF-8"/>
          <!-- index mode for image search
               enableise: whether enable ise.
               buildimageindex: whether build the image representation in indexing.
               storeimagelocally: whether the image will be copied and stored locally in the server.
          -->
          <IsePara buildimageindex="y" storeimagelocally="n" maximagenum="1000000" relatedimagenum="50"/>
          <QueryCorrectionPara enableEK="y" enableCN="y"/>
        </Parameter>
      </MiningBundle>

      <RecommendBundle>
        <Parameter>
          <!-- Specify multiple index directory to support backup and directory rotating -->
          <CollectionDataDirectory>default-recommend-dir</CollectionDataDirectory>
          <CronPara value="0 0 * * *"/>
          <!-- 1G for purchase matrix, 512M for visit matrix, 100M for index buffer -->
          <CacheSize purchase="1073741824" visit="536870912" index="104857600"/>
          <!-- Speicfy "enable" to "yes" if recommend API top_item_bundle() is called -->
          <FreqItemSet enable="no" minfreq="10"/>
        </Parameter>
      </RecommendBundle>
    </BundlesDefault>

    <!-- NOT IMPLEMENTED FOR CURRENT VERSION
         <NumeralRecognition>
         <Dictionary name="price" path="@SF1RENGINE_ROOT@/bin/dictionary/price.txt"/>
         <Dictionary name="weight" path="@SF1RENGINE_ROOT@/bin/dictionary/weight.txt"/>
         </NumeralRecognition>
    -->

    <Firewall>
      <!-- Allow and Deny ip can have four types
           (Full IP type is called class D in this configuration file)
           1. class A type : value="121"       That is 121.*.*.*
           2. class B type : value="121.2"     That is 121.2.*.*
           3. class C type : value="121.2.0"   That is 121.2.0.*
           4. class D type : value="121.2.0.3"

      # Sample #
      <Allow value="211"/>
      <Allow value="127.0"/>
      <Deny  value="127.0.0.1"/>
      <Deny  value="211.39.140.111"/> -->
    </Firewall>

    <Tokenizing>
      <Tokenizer id="tok_divide" method="divide" value="@#$" code=""/>
      <Tokenizer id="tok_unite" method="unite" value="/" code=""/>
    </Tokenizing>


    <!-- ** NEED TO EDIT DICTIONARY PATH ** -->
    <!-- analysis types: token, ngram, like, all, noun, label -->
    <LanguageAnalyzer dictionarypath="@wisekma_KNOWLEDGE@" updatedictinterval="300">

      <Method id="la_token" analysis="token"/>
      <Method id="la_char" analysis="char"/>
      <Method id="la_unigram_all" analysis="char" advoption="all" casesensitive="no"/>
      <Method id="la_unigram" analysis="char" advoption="part" casesensitive="no"/>
      <Method id="la_ngram" analysis="ngram" min="2" max="3" maxno="2194967296" apart="n" idxflag="second" schflag="second"/>
      <Method id="la_bigram" analysis="ngram" min="2" max="2" maxno="2194967296" apart="n" idxflag="second"/>
      <Method id="la_eng" analysis="english" casesensitive="no">
        <settings mode="all" option="S+" dictionarypath=""/>
      </Method>
      <!--
      <Method id="la_korall" analysis="korean">
        <settings mode="all" option="R+S+" specialchar="#" dictionarypath="@wisekma_KNOWLEDGE@"/>
      </Method>
      <Method id="la_kornoun" analysis="korean">
        <settings mode="all" option="R+S+" specialchar="#" dictionarypath="@wisekma_KNOWLEDGE@"/>
      </Method>
      <Method id="inner_la_korall_mia" analysis="korean" casesensitive="yes" >
        <settings mode="label" option="R1S-" specialchar="#" dictionarypath="@wisekma_KNOWLEDGE@"/>
      </Method>
      <Method id="la_bi_mia" analysis="multilang" advoption="default,inner_la_korall_mia;cn,la_bigram" casesensitive="yes" lower="no"/>
      <Method id="la_mia" analysis="multilang" advoption="default,inner_la_korall_mia;cn,la_char" casesensitive="yes" lower="no">
        <settings mode="label"/>
      </Method>
      -->
      <Method id="inner_la_korall_sia" analysis="korean" casesensitive="no" >
        <settings mode="label" option="R+S+" specialchar="#" dictionarypath=""/>
      </Method>

      <Method id="inner_la_cnall_sia" analysis="chinese" casesensitive="no" >
        <settings mode="label" option="R+S-V-T3" specialchar="#" dictionarypath="@izenecma_KNOWLEDGE@"/>
      </Method>
      <Method id="inner_la_cnall_ia" analysis="chinese" casesensitive="no" >
        <settings mode="label" option="R+S-V-T4" specialchar="#" dictionarypath="@izenecma_KNOWLEDGE@"/>
      </Method>
      <Method id="inner_la_cnall_sa" analysis="chinese" casesensitive="no" >
        <settings mode="label" option="R+S-T5" specialchar="#" dictionarypath="@izenecma_KNOWLEDGE@"/>
      </Method>

      <Method id="la_sia" analysis="multilang" advoption="default,inner_la_korall_sia;en,inner_la_cnall_sa;cn,inner_la_cnall_sia"/>
      <Method id="la_sia_with_unigram" analysis="multilang" advoption="default,inner_la_korall_sia;en,inner_la_cnall_sa;cn,inner_la_cnall_ia"/>

      <!--
      <Method id="inner_la_jpall_sia" analysis="japanese" casesensitive="no" >
        <settings mode="label" option="R+S+" specialchar="#" dictionarypath="@izenejma_KNOWLEDGE@"/>
      </Method>
      <Method id="la_sia" analysis="multilang" advoption="default,inner_la_korall_sia;en,la_eng;cn,inner_la_cnall_sia;jp,inner_la_jpall_sia"/>
      <Method id="la_sia_with_unigram" analysis="multilang" advoption="default,inner_la_korall_sia;en,la_eng;cn,inner_la_cnall_index;jp,inner_la_jpall_sia"/>
      -->
    </LanguageAnalyzer>

  </System>


  <Deployment>
    <BrokerAgent usecache="n" threadnum="50" enabletest="y" port="18181"/>

    <!-- Distributed Topology (a SF1 node can work as Worker or Master or both).
      clusterid : identity of the cluster
      nodeid    : id of current node (sf1) in the cluster.
      replicaid : id of current node (sf1) in the replication set.
      shardid   : id of data shard (partition), also used as workerid.
         * shardids (workerids) range from 1 to 'shardnum', without break.
         * it's recommended to keep the shardid consistent with nodeid.
    -->
    <DistributedCommon clusterid="@DEFAULT_CLUSTER_ID@" localhost="172.16.0.36"
                       workerport="18151" notifyrecvport="18131" datarecvport="18121" />

    <DistributedTopology enable="n" type="search" nodenum="2" shardnum="2">
      <CurrentNode replicaid="1" nodeid="1">
        <MasterAgent enable="y">
          <Aggregator name="b5mm"/>
          <Aggregator name="intel"/>
        </MasterAgent>
        <WorkerAgent enable="y" shardid="1">
          <Service name="b5mm"/>
          <Service name="intel"/>
        </WorkerAgent>
      </CurrentNode>
    </DistributedTopology>

    <DistributedTopology enable="n" type="recommend" nodenum="2" shardnum="2">
      <CurrentNode replicaid="1" nodeid="1">
        <MasterAgent enable="y">
          <Aggregator name="b5mm"/>
          <Aggregator name="intel"/>
        </MasterAgent>
        <WorkerAgent enable="y" shardid="1">
          <Service name="b5mm"/>
          <Service name="intel"/>
        </WorkerAgent>
      </CurrentNode>
    </DistributedTopology>

    <DistributedUtil>
      <ZooKeeper servers="172.16.0.161:2181,172.16.0.162:2181,172.16.0.163:2181" sessiontimeout="2000"/>
      <DFS type="hdfs" supportfuse="y" mountdir="/mnt/hdfs" server="localhost" port="9000"/>
    </DistributedUtil>
  </Deployment>

</SF1Config>
